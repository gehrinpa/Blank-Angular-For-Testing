<div class="fixed-head-wrapper">
    <header class="navbar">
        <form class="form-inline">
            <app-request-progress-indicator theme="amplifi"></app-request-progress-indicator>
            <!-- <label for="filter-sector" class="mr-2">Sector: </label>
            <input id="filter-sector" class="form-control my-2" type="text" name="sector" placeholder="Sector Name" autocomplete="off" [(ngModel)]="sectorFilterText" [typeahead]="sectorTypeahead" typeaheadOptionField="name" typeaheadMinLength="3" (typeaheadOnSelect)="sectorSelected($event)" (change)="sectorChange()"/> -->

            <!-- <label for="filter-company" class="mx-2">Company: </label>
            <input id="filter-company" class="form-control my-2" type="text" name="company" placeholder="Company Name"
                autocomplete="off" [(ngModel)]="companyFilterText" [typeahead]="companyTypeahead" typeaheadOptionField="name"
                typeaheadMinLength="2" (onChange)="companyChange()" /> -->

            <!-- <label for="filter-type" class="mx-2">Type: </label>
            <select id="filter-type" class="form-control custom-select my-2" name="planType" [(ngModel)]="planType"
                (change)="planTypeChanged()">
                <option [ngValue]="null">All</option>
                <option [ngValue]="country" *ngFor="let country of countries">{{country.name}}</option>
                 <option>Plan</option>
                <option>Scenario</option>
                <option>Enquiry</option>
            </select>

            <label for="filter-status" class="mx-2">Status: </label>
            <select id="filter-status" class="form-control custom-select my-2" name="planStatus" [(ngModel)]="planStatus"
                (change)="planStatusChanged()">
                <option [ngValue]="null">All</option>
                <option>Live</option>
                <option>Draft</option>
                <option>Archived</option>
            </select> -->
        </form>
    </header>

    <main class="container-fluid">
        <div class="card mb-2">
            <div class="card-body p-2 d-flex flex-wrap">
                <button class="btn btn-outline-danger mr-2" (click)="openCreateCompanyModal(userModalTemplate,'')">Add
                    User</button>
                <button class="btn btn-outline-danger mr-2" (click)="openUserRoleModal(createUserRoleModalTemplate)">Add
                    Role</button>
            </div>
        </div>
        <!-- <div class="card mb-2">
            <div class="card-body p-2 d-flex flex-wrap">
               
            </div>
        </div> -->
        <div class="d-flex flex-wrap plan-list">
            <div class="card" *ngFor="let user of usersList">
                <div class="card-body">
                    <h5 class="card-title d-flex justify-content-between">
                        {{user.companyName}}
                        <span class="badge" [ngClass]="badgeModifier[user.isDeleted]">{{user.isDeleted ? 'Not Active' :
                            'Active'}}</span>
                    </h5>
                    <p class="card-text">
                        <br />
                        User Name: {{user.userName}}<br />
                        Role: <span *ngIf="this.getRoleById(user.userRole)">{{ this.userRole}}</span><br/>
                        Group: <span *ngIf="this.getGroupById(user.userGroup)">{{ this.userGroup }}</span>
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <a class="btn btn-outline-danger" (click)="openCreateCompanyModal(userModalTemplate,user.userId)">Edit</a>
                        <a class="btn btn-outline-danger" (click)="openDeleteModal(user.userId)">Delete</a>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    Created: {{user.createdDate | date}}<br />
                    Modified: {{user.modifiedDate | date}}
                    <i class="material-icons">test</i>
                </div>
            </div>
        </div>
    </main>
</div>

<ng-template #userModalTemplate>
    <div class="modal-header">

        <h4 class="modal-title pull-left" *ngIf="!this.updateUser">Add User</h4>
        <h4 class="modal-title pull-left" *ngIf="this.updateUser">Edit User</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="createCompanyModalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form #createUserForm="ngForm" (submit)="createUserSubmit(usersFormModel)" class="was-validated">
        <div class="modal-body">
            <input type="hidden" id="Id" name="Id" required [(ngModel)]="usersFormModel.id">
            <div class="form-group form-row">
                <label for="createCompanyContactEmail" class="col-sm-4 col-form-label">Email</label>
                <div class="col-sm">
                    <input type="email" class="form-control" id="createUserContactEmail" name="userEmail" required
                        [(ngModel)]="usersFormModel.userEmail">
                </div>
            </div>
            <div *ngIf="this.updateUser">
                    <div class="form-group form-row">
                            <label for="password" class="col-sm-4 col-form-label">Password</label>
                            <div class="col-sm">
                                <input type="password"placeholder="New Password (Optional)" class="form-control" id="createUserPassword" name="password" 
                                    [(ngModel)]="usersFormModel.password">
                            </div>
                        </div>
                        <div class="form-group form-row">
                            <label for="confirmPassword" class="col-sm-4 col-form-label">Confirm Password</label>
                            <div class="col-sm">
                                <input type="password" placeholder="Confirm New Password (Optional)" class="form-control" id="confirmPassword" name="confirmPassword" 
                                    [(ngModel)]="usersFormModel.confirmPassword">
                            </div>
                        </div>
                </div>
            <div *ngIf="!this.updateUser">
                    <div class="form-group form-row">
                            <label for="password" class="col-sm-4 col-form-label">Password</label>
                            <div class="col-sm">
                                <input type="password" class="form-control" id="createUserPassword" name="password" required
                                    [(ngModel)]="usersFormModel.password">
                            </div>
                        </div>
                        <div class="form-group form-row">
                            <label for="confirmPassword" class="col-sm-4 col-form-label">Confirm Password</label>
                            <div class="col-sm">
                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required
                                    [(ngModel)]="usersFormModel.confirmPassword">
                            </div>
                        </div>
            </div>

            <div class="form-group form-row">
                <label for="createCompanyName" class="col-sm-4 col-form-label">Company Name</label>
                <div class="col-sm">
                    <input type="text" class="form-control" id="createCompanyName" name="companyName" required
                        [(ngModel)]="usersFormModel.companyName" placeholder="Name">
                </div>
            </div>
            <div class="form-group form-row">
                <label for="userRole" class="col-sm-4 col-form-label">Role</label>
                <!-- <div class="col-sm">
                    <input type="text" class="form-control" id="userRole" name="userRole"
                        required [ngModel] userRole>
                </div> -->
                <select id="user-roles" class="form-control custom-select my-2" name="userRole" [(ngModel)]="usersFormModel.userRole"
                    required>
                    <option [ngValue]="null">Select Role</option>
                    <option [ngValue]="role.id" *ngFor="let role of rolesList">{{role.name}}</option>
                </select>
            </div>
            <div class="form-group form-row">
              <label for="userGroup" class="col-sm-4 col-form-label">Group</label>
              <select id="user-groups" class="form-control custom-select my-2" name="userGroup" [(ngModel)]="usersFormModel.userGroup">
                  <option [ngValue]="null">Select Group...</option>
                  <option [ngValue]="group.id" *ngFor="let group of groupsList">{{group.name}}</option>
              </select>
          </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="createCompanyModalRef.hide()">Close</button>
            <button type="submit" class="btn btn-outline-danger">Save</button>
        </div>
    </form>
</ng-template>
<ng-template #deleteModalTemplate>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Confirmation</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="deleteModalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        Do you want to delete user?
    </div>
    <div class="modal-footer">
        <button class="btn btn-danger" (click)="deleteSubmit()">Delete</button>
        <button class="btn btn-secondary" (click)="deleteModalRef.hide()">Close</button>
    </div>
</ng-template>


<ng-template #createUserRoleModalTemplate>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Add Role</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="createUserRoleModalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form #createRoleForm="ngForm" (submit)="createRoleSubmit(createRoleForm)" class="was-validated">
        <div class="modal-body">

            <div class="form-group form-row">
                <label for="createuserRoleName" class="col-sm-4 col-form-label">Role Name</label>
                <div class="col-sm">
                    <input type="text" class="form-control" id="userRoleName" name="userRoleName" required [ngModel]
                        userRoleName>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="createUserRoleModalRef.hide()">Close</button>
            <button type="submit" class="btn btn-outline-danger">Create</button>
        </div>
    </form>
</ng-template>